<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="src/index.css">
    <title>SVAppLog</title>
</head>
<body>
    <div class="header">
        <div class="logo">
            <img src="src/logo.png" alt="Logo">
        </div>
    </div>
    <div class="main">
        <item>
            <button id="fetchButton">Fetch JSON Data</button>
            <label for="type">Type:</label>
            <select name="type" id="type">
                <option value="">All</option>
                <option value="login">Login</option>
                <option value="logout">Logout</option>
                <option value="register">Register</option>
                <option value="date">Date</option>
            </select>
            <input type="date" id="datePicker" style="display: none;">
        </item>
        <div id="results">
            <table id="dataGrid" border="1">
                <thead>
                    <tr>
                        <th>User_ID</th>
                        <th>User</th>
                        <th>Action</th>
                        <th>Time stamp</th>
                        <th>Path</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div class="footer">
        <p>For contacts: vaskokole@abv.bg / p0lyb3ar@proton.me</p>
    </div>
</body>
<script>
    document.getElementById('fetchButton').addEventListener('click', fetchData);
    document.getElementById('type').addEventListener('change', handleTypeChange);
    document.getElementById('datePicker').addEventListener('change', fetchData);

    function handleTypeChange() {
        const typeValue = document.getElementById('type').value;
        const datePicker = document.getElementById('datePicker');

        if (typeValue === 'date') {
            datePicker.style.display = 'inline';
        } else {
            datePicker.style.display = 'none';
            fetchData();
        }
    }

    function fetchData() {
        // Simulating fetch data with example data
        const data = {
            "login": [
                { "user_id": "1", "user": "Alice", "timestamp": "2024-07-28T10:00:00", "path": "/login" },
                { "user_id": "2", "user": "Bob", "timestamp": "2024-07-29T10:05:00", "path": "/login" }
            ],
            "logout": [
                { "user_id": "3", "user": "Charlie", "timestamp": "2024-07-28T10:10:00", "path": "/logout" }
            ],
            "register": [
                { "user_id": "4", "user": "Dave", "timestamp": "2024-07-29T10:15:00", "path": "/register" }
            ],
            "other": [
                { "user_id": "5", "user": "Eve", "timestamp": "2024-07-27T10:20:00", "path": "/other" },
                { "user_id": "6", "user": "Frank", "timestamp": "2024-07-29T10:25:00", "path": "/other" }
            ]
        };

        const sortValue = document.getElementById('type').value;
        updateTable(data, sortValue);
    }

    function updateTable(data, sortValue) {
        const tableBody = document.getElementById('dataGrid').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // Clear previous results

        for (const [action, users] of Object.entries(data)) {
            users.forEach(userObj => {
                if (!sortValue || action === sortValue || (sortValue === 'date' && userObj.timestamp.includes(document.getElementById('datePicker').value))) {
                    const newRow = tableBody.insertRow();

                    const userIDCell = newRow.insertCell(0);
                    const userCell = newRow.insertCell(1);
                    const actionCell = newRow.insertCell(2);
                    const timestampCell = newRow.insertCell(3);
                    const pathCell = newRow.insertCell(4);

                    userIDCell.textContent = userObj.user_id || 'None';
                    userCell.textContent = userObj.user || 'None';
                    actionCell.textContent = action || 'None';
                    timestampCell.textContent = userObj.timestamp || 'None';
                    pathCell.textContent = userObj.path || 'None';
                }
            });
        }
    }

    // Initial load
    fetchData();
</script>
</html>
